---
title: "kolokvij_1"
author: "Urban Matjaz"
date: "2025-01-21"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(ggplot2)
library(car)
library(effects)
library(gridExtra)

library(ggpubr)
library(ellipse)
library(dplyr)
library(vtable)
library(reshape)
library(corrplot)
library(knitr)
library(kableExtra)
library(GLMsData)

```

# Osnovni pregled podatkov

```{r}
# Äe so podatki zunanji
data(lungcap)
data = lungcap # da se df imenuje data za naprej...
# Äe je txt file
#data = read.table("blabla.txt", header=T) 
# Äe je csv file

dim(data) # dimenzije vrstice, stolpci
head(data) # zaÄetek tabele
str(data) 
summary(data) # min, max, kvantili, povpreÄje po spr
levels(data$Gender) # levli faktorske spr
#data(data) 

```


# Osnovne prilagoditve spremenljivk

```{r}

# Spremeni napovedno_spr v faktor
data$Gender = factor(data$Gender, labels = c("Å½enske", "MoÅ¡ki"))
data$Smoke = factor(data$Smoke, labels=c("Ne", "Da"))

# Spremeni enote (recimo inch â†’ cm)
data$Ht = data$Ht*2.54

# Dodaj labels faktorski napovedni_spr
#data$spr = factor(data$spr, labels=c("bla1", "bla2"))

# Zamenjaj oznake spr (recimo iz M â†’ moÅ¡ki)
#levels(data$Gender) = c("Zenske", "Moski")
#levels(data$Smoke) = c("Ne", "Da")

# Centriranje napovedne spr
#data$spr_centered = data$spr - cifra

# Z ukazom rownames vsaki vrstici damo ime, to ime sluÅ¾i za identifikacÄ³o podatka na slikah in pri doloÄenih izpisih
#rownames(data) = data$spr

```


# Osnovne vizualizacije

```{r}
# RazvrÅ¡Äanje grafov
#ggarrange(p1, p2, p3, p4, ncol=2, nrow=2) # to daÅ¡ na koncu

# Osnovni razsevni grafikon - 1. moÅ¾nost
ggplot(data = data) +
  geom_point(mapping = aes(x = Ht, y = FEV)) +
  xlab("Å¡tevilska_napovedna_spr (enote)") + ylab("odzivna_spr (enote)") 

# Osnovni razsevni grafikon - 2. moÅ¾nost
ggplot(data, aes(x = Ht, y = FEV)) + 
  geom_point() + 
  xlim(c(110,190)) +
  xlab("Å¡tevilska_napovedna_spr (enote)") + ylab("odzivna_spr (enote)") + theme_bw() # nariÅ¡i veÄ takih grafov za vsako Å¡tevilsko_napovedno_spr, odzivna_spr je ista, za opisne_napovedne_spr naredi boxplote â†’ zdruÅ¾i z ggarrange

# Histogrami
par(mfrow=c(1,2))
hist(data$Ht, main="Porazdelitev spremenljivke Ht", xlab="Ht", ylab="freq", breaks=20)
hist(data$Age, main="Porazdelitev spremenljivke Age", xlab="Age", ylab="freq")

# Sami boxploti
par(mfrow=c(2, 2))
par(cex=0.5)
boxplot(data$FEV ~ data$Age, 
        xlab = "Age", ylab = "FEV")
boxplot(data$FEV ~ data$Ht, 
        xlab = "Ht", ylab = "FEV")
boxplot(data$FEV ~ data$Gender, 
        xlab = "Gender", ylab = "FEV")
boxplot(data$FEV ~ data$Smoke, 
        xlab = "Smoke", ylab = "FEV")

# Osnovni boxplot
ggplot(data, aes(x=Gender, y=FEV)) + 
  geom_boxplot() + 
  xlab("napovedna_spr (enote)") + ylab("odzivna_spr (enote)") + theme_bw()

# Preglej vse kombinacije opisnih_napovednih_spr - boxploti
ggplot(data, aes(x=Gender, y=FEV)) + 
  geom_boxplot() + 
  facet_wrap(.~ Smoke) +
  xlab("opisna_napovedna_spr1") + ylab("odzivna_spr (enota)") + theme_bw()

# Vse kombinacije opisnih_napovednih_spr z gladilniki - za preverjanje linearnosti â†’ ta isti graf izriÅ¡i za vsako od Å¡tevilskih_napovednih_spr!! (samo to zamenjaj "x= " in ime x-osi) â†’ iste grafe ponovi tudi, Äe odzivno_spr transformiraÅ¡ (recimo daj log(odzivna_spr))
ggplot(data, aes(x=Ht, y=FEV)) + 
  geom_point() + 
  geom_smooth(se=TRUE) +
  facet_grid(Gender ~ Smoke) + 
  xlab("Å¡tevilska_napovedna_spr") + ylab("odzivna_spr (enota)") + theme_bw()


# Osnovni razsevni grafikon, Äe imaÅ¡ 2 napovedni spr: eno opisno in eno Å¡tevilsko
ggplot(data = data, aes(x = Ht, y = FEV, col = Gender)) +
  geom_point() + 
  xlab("Å¡tevilska_napovedna_spr (enota)") + ylab("odzivna_spr (mm)")

# Boxplot â†’ uporabi za opisne napovedne spr
boxplot(FEV ~ Gender, data = data, ylab = c("odzivna_spr (enota)"), xlab = "opsina_napovedna_spr")

# V kakÅ¡ni zvezi so pari analiziranih spremenljivk
pairs(data) # Robna odvisnost odzivne spr od napovednih spr, vsaka slika zase ne upoÅ¡teva prisotnosti drugih napovednih spr.

# V ukazu scatterplot iz paketa car se z argumentom id na sliki izpiÅ¡eta imeni izstopajoÄih podatkov in boxplota
# S tem prikazom lahko probaÅ¡ tudi npr. transformirati odzivno spr in prikazati Å¡e enkrat isto!
scatterplot(FEV ~ Age, regLine = FALSE, smooth = FALSE, boxplots = 'xy',
xlab = c("napovedna_spr (enota)"), ylab = c("odzivna_spr (enota)"),
data = data, pch = 16,
id = list(n = 2, location = "lr")) # id = TRUE
```

# Posebne toÄke

```{r}

model_gender = lm(FEV ~ Gender, data = data)
model_age = lm(FEV ~ Age, data = data)
model_op_int = lm(FEV ~ Gender * Age, data = data)
# Regresijski osamelci: studentizirani ostanki glede na kvantile ğ‘¡(SP=ğ‘›âˆ’ğ‘˜âˆ’2) in pripadajoÄa 95 % toÄkovna ovojnica (QQ grafikon)
qqPlot(model_gender, id = TRUE)
qqPlot(model_age, id = TRUE)
qqPlot(model_op_int, id = TRUE)

# Za vsako toÄko posebej preverjamo, ali je regresÄ³ski osamelec. NiÄelna domneva pravi, da ğ‘–-ta toÄka ni regresÄ³ski osamelec. IzpiÅ¡e vse tiste toÄke, pri katerih je nepopravljena ğ‘-vrednost pod 0.05.
outlierTest(model_gender) # toÄka je reg osamelec, Äe je Bonferroni p-vrednost manjÅ¡a od 0.05 
outlierTest(model_age) # toÄka je reg osamelec, Äe je Bonferroni p-vrednost manjÅ¡a od 0.05 
outlierTest(model_op_int, id = TRUE) # toÄka je reg osamelec, Äe je Bonferroni p-vrednost manjÅ¡a od 0.05 

# Da preveriÅ¡ kako se modelske napovedi razlikujejo od dejanskih toÄk - regresijski osamelci
data[c(539, 576), ]
fitted(model_op_int)[c(539, 576)]
data$FEV[c(539, 576)] # brez log, Äe ga ne uporabljaÅ¡!


# Vzvodne toÄke:  Vzvod v odvisnosti od napovedne_spr za model
plot(data$Age, hatvalues(model_op_int), pch = 16,
xlab = c("napovedna_spr (enota)"), ylab = c("Vzvod"))

# GrafiÄni prikaz studentiziranih ostankov, vzvodov in Cookove razdalje (ploÅ¡Äina kroga je sorazmerna Cookovi razdalji) za model
influencePlot(model_op_int,
              id = list(method = "noteworthy", n = 2, cex = 1, location = "lr"),
              xlab = "Vzvodi", ylab = "Studentizirani ostanki") # n = Å¡tevilo toÄk z najveÄjo vrednostjo studentiziranega ostanka, ğ‘ toÄk z najveÄjim vzvodom in ğ‘ toÄk z najveÄjo Cookovo razdaljo (pogosto se toÄke prekrivajo in jih je v izpisu manj kot 3ğ‘)
# poglej tabelo za cookove vrednosti, Äe so veÄje od 1 + na grafu, katere toÄko so Äez Ärtkano Ärto - te imajo velik vzod - Äe imajo oboje skupaj, so vplivne toÄke.

# Vplivne toÄke:
vplivne = lm.influence(model_op_int)
names(vplivne)
sort(vplivne$hat, decreasing = TRUE)[1:4] # 4 toÄke z najveÄjimi vzvodi
vplivne$coeff["628",] # spremembi ocen b_0 in b_1, Äe specifiÄno toÄko izloÄimo
sort(vplivne$coeff[,1],decreasing=TRUE)[1:4] # 4 toÄke z najveÄjo spremembo b_0
sort(vplivne$coeff[,2])[1:4] # 4 toÄke z najveÄjo spremembo naklona
sort(vplivne$sigma)[1:4] # izpis standardnih napak regresije brez vkljuÄenega podatka/toÄke

#data.brez = subset(data, subset = data$napovedna_spr2 != "specifiÄna_toÄka")
#model.brez = lm(data ~ napovedna_spr1, data = data.brez)

# Primerjajmo ocene parametrov in njihove standardne napake za model in model.brez
#compareCoefs(model, model.brez)

# IzloÄi vplivno toÄko
#data = data[-which(data$spr==cifra),]

# 

```
pr teh zadnih 4 ukazih nevem tocn kaj se zgodi treba se prevert


# Vse mnoÅ¾nosti za modele

## Brez interakcij

```{r}
# Ena napovedna spr
m0 = lm(FEV ~ Gender, data = data)

# Dve napovedni spr
m1 = lm(FEV ~ Gender + Age, data = data)


# Komponente modela:
names(m0)

# Koeficienti modela
m0$coef

```


## Z interakcijami

```{r}
#model = lm(odzivna_spr ~ napovedna_spr1 + napovedna_spr2 + napovedna_spr1:napovedna_spr2, data = data) # isto kot:
model = lm(FEV ~ Gender * Age, data = data)

modelska_matrika = model.matrix(model)
head(modelska_matrika, n = 3)

model$coeff # Poglej Å¡tevilo ocenjenih parametrov v modelu

# ... nadaljuj z 
anova(model)
```


## Transformacije

```{r}
# Izbira transformacije
symbox(~ FEV, xlab = "Lambda",
ylab = "Transformirane vrednosti za odzivno_spr",
data = data) # IzbereÅ¡ tisto, kjer je boxplot najbolj simetriÄen, najbolj podoben ~ N

# Oceni, katera lambda bi bila glede na maximum likelihood primerna
summary(powerTransform(model)) # razlaga spodaj

# Logaritem verjetja v odvisnosti od ğœ† za model, optimalna vrednost za ğœ† in njen 95 % IZ
par(mar = c(4, 4, 1, 1))
boxCox(model) # Pazi pri teh transformacijah, vÄasih ni razloÅ¾ljivo!

################################################################################

# Interpretacija eksponentne zveze:
model_exp = lm(log(FEV) ~ Age*Ht*Gender*Smoke, data = data)
(b = coefficients(model_exp))
exp(b[1]) # Eksponiraj intercept (beta0) â†’ Interpretacija je zdaj lahko: Ob napovedni_spr = 0, je odzivna_spr enaka exp(b[1]).
exp(confint(model_exp)[1,]) # Eksponiraj IZ za intercept
exp(b[2])-1 # Eksponiraj beta1 â†’ interpretacija je zdaj lahko: ÄŒe se napovedna_spr spremeni za 1, se odzivna_spr spremeni za exp(b[2])-1 * 100 %. 
exp(confint(model_exp)[2,])-1 # Eksponiraj IZ za beta1
summary(model_exp)$r.squared

# GrafiÄni prikazi za exp zvezo

## 1.1 naÄin
plot(effect(c("Ht", "Age", "Smoke", "Gender"), model_exp,
            transformation = list(link = log, inverse = exp)),
     axes = list(y = list(lab = "odzivna_spr")), main = "") # Odvisnost odzivne_spr od napovedna_spr in pripadajoÄa regresijska premica s 95 % IZ za povpreÄno napoved odzivne_spr, skala za odzivno_spr je logaritemska!!!!

## 1.2 naÄin
plot(Effect(c("Age", "Ht", "Smoke", "Gender"), model_exp,
            transformation = list(link = log,inverse = exp)),
     axes = list(y = list(lab = "odzivna_spr (enota)", type = "response")),
     multiline=TRUE, ci.style="bands", main="")

plot(Effect(c("Age","Ht","Gender","Smoke"), model_exp, partial.residuals=TRUE, transformation = list(link = log,inverse = exp)), main="", multiline = TRUE)

## 2. naÄin
ggplot(data = data, aes(x = Ht, y = log(FEV))) +
geom_point() + stat_smooth(method = "lm") +
xlab("napovedna_spr (enote!!!)") + ylab("log(odzivna_spr)") # Odvisnost log(odzivna_spr) od napovedna_spr in pripadajoÄa regresijska premica s 95 % IZ za povpreÄno napoved log(odzivna_spr)


# GrafiÄni prikazi (de-transformacija) za exp zvezo
ggplot(data = data, aes(x = Ht, y = FEV)) +
  geom_point() + xlab("napovedna_spr (enote)") + ylab("odzivna_spr (enote)") +
  stat_function(fun = function(Ht) exp(b[1] + b[2] * Ht)) #  Odvisnost odzivna_spr od napovedna_spr; eksponentni model

```

* powerTransform razlaga: poiÅ¡Äemo parametre pri katerih je verjetje za y najveÄje. Oceno ğœ†Ì‚ dobimo z numeriÄnim postopkom kjer za razliÄne vrednosti ğœ†Ì‚ izraÄunamo verjetje za y. Izberemo ğœ†, pri kateri ima logaritem verjetja maksimalno vrednost. powerTransform vrne optimalni ğœ† in pripadajoÄi IZ ter izvede dva informativna testa:
**ğ»0âˆ¶ ğœ† = 0 (ustrezna je logaritemska transformacija)
**ğ»0âˆ¶ ğœ† = 1 (ğ‘¦ ni treba transformirati)


## Vizualizacije modelov

```{r}
head(model.matrix(model)) # da preveriÅ¡ referenÄne skupine
tail(model.matrix(model)) 

# Dodatek regresijske premice na razsevni grafikon
ggplot(data = data, mapping = aes(x = Ht, y = FEV)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) + # Äe daÅ¡ se=TRUE dobiÅ¡ 95% IZ za povpreÄno napoved!!
xlab("napovedna_spr (enote)") + ylab("odzivna_spr (enote)")

# Graf dodane spremenljivke
avPlots(m1, ylim = c(-3, 5)) # Vpliv vsake od napovednih spr na odzivno spr ob upoÅ¡tevanju ostalih spr v modelu (= pri konstantni vrednosti ostalih spr) - naklon je enak oceni parametrov za tisto spremenljivko

# 3D grafikon za dve Å¡tevilski spremenljivki hkrati
# avPlot3d(mod2, coef1="Age", coef2="Ht")

# Graf parcialnih ostankov
crPlots(m1, ylim = c(-5, 5))# Odvisnosti odzivne spr od posamezne napovedne spr upoÅ¡tevajoÄ drugo/-e spr v modelu â†’ BREZ INTERAKCIJ


plot(Effect(c("Age", "Ht", "Gender", "Smoke"), model_exp), partial.residuals = TRUE, multiline=FALSE,
     ci.style="bands", main="", ylim=c(-3,3)) #  Modelske napovedi za odzivno_spr v odvisnosti od spr1, spr2 in spr3 hkrati, pri povpreÄni vrendosti spr4 za model â†’ Z INTERAKCIJAMI (iste grafe nariÅ¡eÅ¡ pred in po vkljuÄitvijo interakcij!!) â†’ glej interakcije

# Druga moÅ¾nost grafa parcialnih ostankov
plot(predictorEffects(m1, ~., partial.residuals = TRUE),
ci.style = "none", ylim = c(0, 8), main = "") # Napovedane vrednosti za povpreÄno odzivno_spr za m1 in parcialni ostanki z gladilnikom; levo: glede na napovedno_spr1 pri povpreÄni napovedni_spr2, desno: glede na napovedno_spr2 pri povpreÄni napovedni_spr1.

# GrafiÄni prikaz napovedi in pripadajoÄih intervalov zaupanja za povpreÄne napovedi
plot(predictorEffects(m1, ~.), main = "") # Napovedane vrednosti in 95 % intervali zaupanja za povpreÄno odzivno_spr za m1; levo: glede na napovedno_spr1 pri povpreÄni napovedni_spr2, desno: glede na napovedno_spr2 pri povpreÄni napovedni_spr1.

#!!! graf parcialnih ostankov razlaga: 
plot(predictorEffect(c("Gender"), model))
# Razlaga: PovpreÄne napovedi za odzivno_spr (y os) v odvisnosti od napovedne_spr1 (x os) in napovedne_spr2 (veÄ grafov glede na to spr - vrednosti v naslovih grafov) pri povpreÄni vrednosti napovedne_spr3.

```

Razlaga:

*crPlots: Za Å¡tevilske regresorje modra Ärtkana premica prikazuje modelske napovedi odzivne_spr glede na vrednosti posameznega regresorja pri povpreÄnih vrednostih ostalih regresorjev; toÄke predstavljajo parcialne ostanke za regresor, ki je na vodoravni osi. Gladilnik je narisan na podlagi parcialnih ostankov.


# Diagnostika modela

```{r}
# slike ostankov
par(mfrow = c(2, 2))
plot(model)

# Cel izpis za model
summary(model)
names(summary(model)) # za dodatne ali posamezne izpise

# SSmodel in SSresidual
anova(model)

# Intervala zaupanja za parametra modela
confint(model) # Interpretacija: ÄŒe se napovedna_spr poveÄa za 1 (enota), pri 95 % zaupanju priÄakujemo, da se bo odzivna_spr poveÄala na intervalu spodnja_meja (enota) do zgornja_meja (enota). â†’ lahko pri interpretaciji tudi mnoÅ¾iÅ¡ vse z 10 ali 100

# F-test za dva gnezdena modela: 
anova(m1, model) #prvi je gnezden (to pomeni da ima manj regresorjev npr.: nima interakcije)

# R2 in ocene parametrov s pripadajoÄimi 95 % parcialnimi IZ
summary(model)$r.squared 



#########################  INTERAKCIJE ##############################

par(mfrow = c(1,1))


# Indentifikacija interakcije med dvema Å¡tevilskima napovednima spr
graf1 = plot(Effect(c("Age", "Gender"), model, partial.residuals = TRUE), 
             ci.style = "none", lattice = list(layout = c(4, 1)))
graf2 = plot(Effect(c("Gender", "Age"), model, partial.residuals = TRUE),
             ci.style = "none", lattice = list(layout = c(4, 1)))
grid.arrange(graf1, graf2) # razlaga spodaj

# Rezultati sekvenÄnih F-testov
anova(model) # Razlaga: P04, stran 24

# Interakcija med opisno in Å¡tevilsko napovedno spr
# Ta plot je bil narejen za vzporedni premici:
plot(Effect(c("Age", "Gender"), model), # lahko isti graf narediÅ¡ brez/z interakcijo
     multiline = TRUE, ci.style = "bands",
     key.args = list(x = 0.05, y = 0.8, corner = c(0, 0)),
     main = "", lty = c(1:2))

```

Razlaga:

* Effect plot: grafi prikazujejo napovedi za model in parcialne ostanke z gladilnikom pri razliÄnih vrednostih druge spremenljivke v modelu. Tak grafiÄni prikaz omogoÄa identifikacijo interakcije med dvema Å¡tevilskim spremenljivkama. Premice, ki predstavljajo napovedi modela, so na vseh razdelkih grafikona vzporedne. ÄŒe se gladilniki parcialnih ostankov prilegajo tem premicam, to pomeni, da ni interakcije med spremenljivkama, Äe pa je naklon gladilnikov v razdelkih razliÄen, to nakazuje interakcijo.


# Interpretacije parametrov

## Osnovna linarna regresija brez interakcij

* Intercept: PriÄakovana vrednost odzivne_spr pri napovedni_spr 0, je beta0.
* Beta1: Ko se napovedna_spr poveÄa za 1, se odzivna_spr poveÄa za beta1.

## Linerna regresija z 2 regresorjema brez interakcij
* Beta2: Torej velja, Äe napovedno_spr2 poveÄamo za eno enoto in ostane izbrana vrednost napovedne_spr1 nespremenjena, se priÄakovana vrednost ğ‘¦ poveÄa za beta2.

** Z drugimi besedami: pri poljubni vrednosti napovedne_spr1 velja: Äe se napovedna_spr2 poveÄa za eno enoto, se odzivna_spr2 v povpreÄju poveÄa za beta2, pripadajoÄ 95 % IZ je (_,_) 

## Linearna regresija z opisno napovedno spr z 2 vrednostima
Grafi ostankov: Tu primerjamo varianci napovedne_spr v dveh skupinah.

Glede na summary(model)$coeff:
* Intercept = beta0: povpreÄje odzivne_spr pri referenÄni skupini (preko p-vrednosti poglej, Äe je statistiÄno znaÄilno razliÄno od 0)
* za drugo vrednost napovedne_spr (nereferenÄna skupina): NereferenÄan skupina ima za ___preberi cifro v 2. vrstici izpisa__ manjÅ¡o/veÄjo vrednost odzivne_spr kot referenÄna skupina (pogledaÅ¡ p-vrednost, Äe je razlika med povpreÄjema referenÄne in nereferenÄne skupine znaÄilna).

## Linearna regresija z opisno napovedno spr z veÄ kot dvema vrednostma
Glede na summary(model)$coeff:
* Intercept: povpreÄje odzivne_spr za referenÄno skupino A
* beta1: razlika povpreÄja odzivne_spr v skupini B in povpreÄja odzivne_spr v skupini A
* beta2: razlika povpreÄja odzivne_spr v skupini C in povpreÄja odzivne_spr v skupini A

Najprej preverimo anova(model), da vidimo, Äe se splaÄa gledati povzetek modela (anova je preverila, ali se model, ki vkljuÄuje beta0 in beta1 znaÄilno razlikuje od tistega, ki je vkljuÄeval le beta0).


## Linearna regresija z opisno in Å¡tevilsko napovedno spr. 
â†’ 2 premici, 2 moÅ¾nosti:

### vzporedni, Äe ne vkljuÄimo interakcij:
  * beta0: povpreÄna vrednost odzivne_spr pri referenÄni skupini opisne_napovdne_spr in ko je Å¡tevilska_napovedna_spr enaka 0
  
  * beta1: razlika povpreÄja odzivne_spr za referenÄno in nereferenÄno skupino opisne_napovedna_spr pri vseh vrednostih Å¡tevilske_napovedne_spr [min,max] 
  â†’ ReferenÄna skupina ima pri vseh analiziranih vrednostih Å¡tevilske_napovedne_spr za beta1 veÄjo/manjÅ¡o vrednost povpreÄne odzivne_spr kot nereferenÄna skupina opisne_napovedne_spr. PripadajoÄi IZ je: glej confint(model).
  
  * beta2: naklon vzporednih premic
  â†’ ÄŒe se Å¡tevilska_napovedna_spr poveÄa za 1 (ali mnoÅ¾i z 10), se ob upoÅ¡tevanju opisne_napovedne_spr odzivna_spr v povpreÄju poveÄa za beta2. PripadajoÄi IZ je: glej confint(model).


### se sekata (drugaÄna naklona, drugaÄni zaÄetni vrednosti), Äe vkljuÄimo interakcije:
  * beta0: povpreÄna vrednost odzivne_spr pri referenÄni skupini opisne_napovedne_spr in ko je Å¡tevilska_napovedna_spr enaka 0
  
  * beta1: razlika povpreÄja odzivne_spr za referenÄno in nereferenÄno skupino opisne_napovedne_spr, ko je Å¡tevilska_napovedna_spr enaka 0
  
  * beta2: naklon premice za referenÄno skupino opisne_napovedne_spr
  
  * beta3: razlika naklonov premic za referenÄno skupino opisne_napovedne_spr in nereferenÄno skupino



## Interakcija dveh Å¡tevilskih spremenljivk
Pri razliÄnih vrednosti napovedne_spr1 je vpliv napovedne_spr2 na odzivno_spr razliÄen, interakcija napovedna_spr1:napovedna_spr2 je negativna/pozitivna in statistiÄno znaÄilna/neznaÄilna (ğ‘ = _). Glej: summary(model)$coeff.

Povedano drugaÄe: ÄŒe x2 poveÄamo za eno enoto in ostane x1 nespremenjen, se priÄakovana vrednost y poveÄa za beta2 + beta3*x1. â†’ sprememba je pri razliÄnih vrednostih x1 razliÄna

## Interakcija Å¡tevilske in opisne napovedne spr
Grej zgoraj "se sekata (drugaÄna naklona, drugaÄni zaÄetni vrednosti), Äe vkljuÄimo interakcije".


# PovpreÄna in posamiÄna napoved

```{r}
#vrednosti = data.frame(napovedna_spr1 = cifra, napovedna_spr2 = cifra)
#povp.napoved = predict(m1, vrednosti, interval = "confidence")
#pos.napoved = predict(m1, vrednosti, interval = "prediction")
#print(data.frame(cbind(vrednosti, povp.napoved, pos.napoved)))
```


# Gnezdeni model

anova(mod1,mod2)

* pri majhni p-vrednosti:
ğ¹-test za primerjavo dveh gnezdenih modelov (mod1 in mod2) pokaÅ¾e, da mod2 pojasni statistiÄno pomemben del variabilnosti odzivne_spr. Modela mod1 in mod2 nista ekvivalentna (ğ‘ = _), boljÅ¡i je kompleksnejÅ¡i mod2.

Prisotnost interakcije lahko preverimo tudi na podlagi $F$-testa za primerjavo gnezdenih modelov, ki testira domnevo, da sta modela ekvivalentna.

# SekvenÄni F-test

anova(model)

Poglej katere interkaicje so statistiÄno znaÄilne.
Ali je interakcija v modelu potrebna ali ne lahko preverimo z $F$-testom. Z ukazom `anova(model)` izvedemo sekvenÄni $F$-test, ki testira vpliv posamezne spremenljivke ob upoÅ¡tevanju predhodnjih spremenljivk v modelu.


# TeoretiÄna vpraÅ¡anja

* Na kaj vpliva heteroskedastiÄnost? 
Vpliva na stand napake ocen parametorv - lahko so podcenjene ali precenjene (ponavadi podcenjene). Variabilnost bo napaÄno ocenjena - manjÅ¡e SE - testno statistiko delimo s SE, torej bo t stat veÄja - p vrednost bo manjÅ¡a kot v resnici - preveÄkrat bomo zavrnili H0. Inferenca je problem, ne ocene.


* Predpostavke linearnega modela in kako odpravimo predpostavke (4. sklop)

* Kako heterskedastiÄnost vpliva na inferenco modela?
Leva grafikona v prvi in drugi vrstici kaÅ¾eta nekonstantno varianco. Varianca ostankov naraÅ¡Äa
z napovedanimi vrednostmi (zgornja leva sliÄica), slika ostankov je podobna klinu: variabilnost
ostankov naraÅ¡Äa od leve proti desni. Prisotnost nekonstantne variance Å¡e bolje pokaÅ¾e gladilnik
na levi spodnji sliki, kjer so na vodoravni osi napovedane vrednosti, na navpiÄni osi pa koreni
absolutnih vrednosti standardiziranih ostankov.
V tem primeru so ocene parametrov sicer ustrezne (pri dokazu nepristranskosti cenilk smo pokazali,
da ne potrebujemo predpostavke o konstantni varianci), njihove standardne napake pa ne, zato
kakrÅ¡nakoli inferenca za ta model ni utemeljena.

